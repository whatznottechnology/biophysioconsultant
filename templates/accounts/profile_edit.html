{% extends 'base.html' %}
{% load static %}

{% block title %}Edit Profile - {{ site_settings.site_name }}{% endblock %}

{% block content %}
<!-- Edit Profile Header -->
<section class="bg-gradient-to-r from-green-600 to-blue-600 text-white py-12">
    <div class="container mx-auto px-4">
        <div class="flex items-center">
            <a href="{% url 'accounts:profile' %}" 
               class="mr-4 bg-white/20 hover:bg-white/30 rounded-lg p-2 transition-colors">
                <i class="fas fa-arrow-left text-xl"></i>
            </a>
            <div>
                <h1 class="text-3xl font-bold mb-2">Edit Profile</h1>
                <p class="text-green-100">Update your personal information</p>
            </div>
        </div>
    </div>
</section>

<!-- Edit Profile Form -->
<section class="py-12 bg-white">
    <div class="container mx-auto px-4">
        <div class="max-w-2xl mx-auto">
            <div class="bg-white border border-gray-200 rounded-lg shadow-sm">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-900">Personal Information</h2>
                </div>
                
                <form method="post" enctype="multipart/form-data" class="p-6">
                    {% csrf_token %}
                    
                    <!-- Display form errors -->
                    {% if form.non_field_errors %}
                        <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6">
                            {% for error in form.non_field_errors %}
                                <p class="text-sm">{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}

                    <div class="space-y-6">
                        <!-- Profile Picture -->
                        {% if form.profile_picture %}
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Profile Picture</label>
                            <div class="flex items-center space-x-4">
                                {% if user.profile_picture %}
                                <img src="{{ user.profile_picture.url }}" alt="Current Profile" 
                                     class="w-16 h-16 rounded-full object-cover border-2 border-gray-200">
                                {% else %}
                                <div class="w-16 h-16 bg-gray-200 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user text-gray-500 text-xl"></i>
                                </div>
                                {% endif %}
                                <div class="flex-1">
                                    {{ form.profile_picture }}
                                    <p class="text-xs text-gray-500 mt-1">JPG, PNG up to 2MB</p>
                                </div>
                            </div>
                            {% if form.profile_picture.errors %}
                                <div class="mt-1">
                                    {% for error in form.profile_picture.errors %}
                                        <p class="text-sm text-red-600">{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        {% endif %}

                        <!-- Name Fields -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="{{ form.first_name.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                    First Name *
                                </label>
                                <input type="text" 
                                       name="{{ form.first_name.name }}" 
                                       id="{{ form.first_name.id_for_label }}"
                                       value="{{ form.first_name.value|default:'' }}"
                                       class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                       required>
                                {% if form.first_name.errors %}
                                    <div class="mt-1">
                                        {% for error in form.first_name.errors %}
                                            <p class="text-sm text-red-600">{{ error }}</p>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div>
                                <label for="{{ form.last_name.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                    Last Name *
                                </label>
                                <input type="text" 
                                       name="{{ form.last_name.name }}" 
                                       id="{{ form.last_name.id_for_label }}"
                                       value="{{ form.last_name.value|default:'' }}"
                                       class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                       required>
                                {% if form.last_name.errors %}
                                    <div class="mt-1">
                                        {% for error in form.last_name.errors %}
                                            <p class="text-sm text-red-600">{{ error }}</p>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Contact Information -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="{{ form.email.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                    Email Address *
                                </label>
                                <input type="email" 
                                       name="{{ form.email.name }}" 
                                       id="{{ form.email.id_for_label }}"
                                       value="{{ form.email.value|default:'' }}"
                                       class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                       required>
                                {% if form.email.errors %}
                                    <div class="mt-1">
                                        {% for error in form.email.errors %}
                                            <p class="text-sm text-red-600">{{ error }}</p>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div>
                                <label for="{{ form.phone_number.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                    Phone Number
                                </label>
                                <input type="tel" 
                                       name="{{ form.phone_number.name }}" 
                                       id="{{ form.phone_number.id_for_label }}"
                                       value="{{ form.phone_number.value|default:'' }}"
                                       class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                       placeholder="9876543210"
                                       pattern="[0-9]{10}"
                                       title="Please enter a 10-digit phone number">
                                <p class="mt-1 text-xs text-gray-500">Enter 10-digit mobile number</p>
                                {% if form.phone_number.errors %}
                                    <div class="mt-1">
                                        {% for error in form.phone_number.errors %}
                                            <p class="text-sm text-red-600">{{ error }}</p>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- WhatsApp Number -->
                        <div>
                            <label for="{{ form.whatsapp_number.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                <i class="fab fa-whatsapp text-green-600 mr-1"></i>
                                WhatsApp Number
                            </label>
                            <input type="tel" 
                                   name="{{ form.whatsapp_number.name }}" 
                                   id="{{ form.whatsapp_number.id_for_label }}"
                                   value="{{ form.whatsapp_number.value|default:'' }}"
                                   class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                   placeholder="9876543210"
                                   pattern="[0-9]{10}"
                                   title="Please enter a 10-digit WhatsApp number">
                            <p class="mt-1 text-xs text-gray-500">Enter 10-digit WhatsApp number for appointment updates</p>
                            {% if form.whatsapp_number.errors %}
                                <div class="mt-1">
                                    {% for error in form.whatsapp_number.errors %}
                                        <p class="text-sm text-red-600">{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <!-- Personal Details -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div>
                                <label for="{{ form.date_of_birth.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                    Date of Birth
                                </label>
                                <input type="date" 
                                       name="{{ form.date_of_birth.name }}" 
                                       id="{{ form.date_of_birth.id_for_label }}"
                                       value="{{ form.date_of_birth.value|date:'Y-m-d'|default:'' }}"
                                       max="{{ today|date:'Y-m-d' }}"
                                       class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                {% if form.date_of_birth.errors %}
                                    <div class="mt-1">
                                        {% for error in form.date_of_birth.errors %}
                                            <p class="text-sm text-red-600">{{ error }}</p>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div>
                                <label for="{{ form.age.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                    Age
                                </label>
                                <input type="number" 
                                       name="{{ form.age.name }}" 
                                       id="{{ form.age.id_for_label }}"
                                       value="{{ form.age.value|default:'' }}"
                                       min="1"
                                       max="120"
                                       class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                       placeholder="Age">
                                {% if form.age.errors %}
                                    <div class="mt-1">
                                        {% for error in form.age.errors %}
                                            <p class="text-sm text-red-600">{{ error }}</p>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div>
                                <label for="{{ form.gender.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                    Gender
                                </label>
                                <select name="{{ form.gender.name }}" 
                                        id="{{ form.gender.id_for_label }}"
                                        class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                    <option value="">Select Gender</option>
                                    <option value="M" {% if form.gender.value == 'M' %}selected{% endif %}>Male</option>
                                    <option value="F" {% if form.gender.value == 'F' %}selected{% endif %}>Female</option>
                                    <option value="O" {% if form.gender.value == 'O' %}selected{% endif %}>Other</option>
                                </select>
                                {% if form.gender.errors %}
                                    <div class="mt-1">
                                        {% for error in form.gender.errors %}
                                            <p class="text-sm text-red-600">{{ error }}</p>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Address -->
                        {% if form.address %}
                        <div class="border-t border-gray-200 pt-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">Address Information</h3>
                            
                            <div class="space-y-4">
                                <div>
                                    <label for="{{ form.address.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                        Complete Address
                                    </label>
                                    <textarea name="{{ form.address.name }}" 
                                              id="{{ form.address.id_for_label }}"
                                              rows="3"
                                              class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                              placeholder="House/Flat No., Building Name, Street, Locality">{{ form.address.value|default:'' }}</textarea>
                                    {% if form.address.errors %}
                                        <div class="mt-1">
                                            {% for error in form.address.errors %}
                                                <p class="text-sm text-red-600">{{ error }}</p>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label for="{{ form.city.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                            City
                                        </label>
                                        <input type="text" 
                                               name="{{ form.city.name }}" 
                                               id="{{ form.city.id_for_label }}"
                                               value="{{ form.city.value|default:'' }}"
                                               class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                               placeholder="Enter city">
                                        {% if form.city.errors %}
                                            <div class="mt-1">
                                                {% for error in form.city.errors %}
                                                    <p class="text-sm text-red-600">{{ error }}</p>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    
                                    <div>
                                        <label for="{{ form.state.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                            State
                                        </label>
                                        <input type="text" 
                                               name="{{ form.state.name }}" 
                                               id="{{ form.state.id_for_label }}"
                                               value="{{ form.state.value|default:'' }}"
                                               class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                               placeholder="Enter state">
                                        {% if form.state.errors %}
                                            <div class="mt-1">
                                                {% for error in form.state.errors %}
                                                    <p class="text-sm text-red-600">{{ error }}</p>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    
                                    <div>
                                        <label for="{{ form.pincode.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                            Pincode
                                        </label>
                                        <input type="text" 
                                               name="{{ form.pincode.name }}" 
                                               id="{{ form.pincode.id_for_label }}"
                                               value="{{ form.pincode.value|default:'' }}"
                                               class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                               placeholder="123456"
                                               pattern="[0-9]{6}"
                                               title="Please enter a 6-digit pincode">
                                        <p class="mt-1 text-xs text-gray-500">Enter 6-digit pincode</p>
                                        {% if form.pincode.errors %}
                                            <div class="mt-1">
                                                {% for error in form.pincode.errors %}
                                                    <p class="text-sm text-red-600">{{ error }}</p>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Emergency Contact -->
                        {% if form.emergency_contact_name %}
                        <div class="border-t border-gray-200 pt-6">
                            <div class="flex items-center mb-4">
                                <i class="fas fa-phone-alt text-red-600 text-xl mr-2"></i>
                                <h3 class="text-lg font-medium text-gray-900">Emergency Contact</h3>
                            </div>
                            <p class="text-sm text-gray-600 mb-4">
                                Provide emergency contact details for urgent situations
                            </p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label for="{{ form.emergency_contact_name.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                        Contact Name
                                    </label>
                                    <input type="text" 
                                           name="{{ form.emergency_contact_name.name }}" 
                                           id="{{ form.emergency_contact_name.id_for_label }}"
                                           value="{{ form.emergency_contact_name.value|default:'' }}"
                                           class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                           placeholder="Emergency contact name">
                                    {% if form.emergency_contact_name.errors %}
                                        <div class="mt-1">
                                            {% for error in form.emergency_contact_name.errors %}
                                                <p class="text-sm text-red-600">{{ error }}</p>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                
                                <div>
                                    <label for="{{ form.emergency_contact_phone.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                        Contact Phone
                                    </label>
                                    <input type="tel" 
                                           name="{{ form.emergency_contact_phone.name }}" 
                                           id="{{ form.emergency_contact_phone.id_for_label }}"
                                           value="{{ form.emergency_contact_phone.value|default:'' }}"
                                           class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                                           placeholder="9876543210"
                                           pattern="[0-9]{10}"
                                           title="Please enter a 10-digit phone number">
                                    <p class="mt-1 text-xs text-gray-500">Enter 10-digit mobile number</p>
                                    {% if form.emergency_contact_phone.errors %}
                                        <div class="mt-1">
                                            {% for error in form.emergency_contact_phone.errors %}
                                                <p class="text-sm text-red-600">{{ error }}</p>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        <!-- Form Actions -->
                        <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-gray-200">
                            <button type="submit" 
                                    class="flex-1 bg-green-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-green-700 transition-colors">
                                <i class="fas fa-save mr-2"></i>
                                Save Changes
                            </button>
                            
                            <a href="{% url 'accounts:profile' %}" 
                               class="flex-1 bg-gray-100 text-gray-700 py-3 px-6 rounded-lg font-semibold text-center hover:bg-gray-200 transition-colors">
                                Cancel
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>
{% endblock %}